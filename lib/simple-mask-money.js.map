{"version":3,"file":"simple-mask-money.js","sources":["../src/args.js","../src/core.js","../src/implanter.js","../src/index.js"],"sourcesContent":["module.exports = class Args {\n  constructor(args) {\n    this.afterFormat         = () => {}; \n    this.allowNegative       = false;  \n    this.beforeFormat        = () => {};  \n    this.negativeSignAfter   = false;\n    this.decimalSeparator    = ',';\n    this.fixed               = true;\n    this.fractionDigits      = 2;\n    this.prefix              = '';\n    this.suffix              = '';\n    this.thousandsSeparator  = '.';\n    this.cursor              = 'move';\n\n    this.merge(args);\n  }\n\n  merge(args) {\n    if (!args || typeof args !== 'object') return;\n\n    this.fractionDigits = typeof args.fractionDigits === 'undefined' || isNaN(args.fractionDigits) ? this.fractionDigits : parseInt(args.fractionDigits);\n    this.afterFormat    = typeof args.afterFormat    === 'function' ? args.afterFormat  : this.afterFormat;\n    this.beforeFormat   = typeof args.beforeFormat   === 'function' ? args.beforeFormat : this.beforeFormat;\n\n    this.fixed             = typeof args.fixed             === 'boolean' ? args.fixed             : this.fixed;\n    this.allowNegative     = typeof args.allowNegative     === 'boolean' ? args.allowNegative     : this.allowNegative;    \n    this.negativeSignAfter = typeof args.negativeSignAfter === 'boolean' ? args.negativeSignAfter : this.negativeSignAfter;\n\n    this.decimalSeparator   = typeof args.decimalSeparator   === 'undefined' ? this.decimalSeparator   : args.decimalSeparator;\n    this.prefix             = typeof args.prefix             === 'undefined' ? this.prefix             : args.prefix;\n    this.suffix             = typeof args.suffix             === 'undefined' ? this.suffix             : args.suffix;\n    this.thousandsSeparator = typeof args.thousandsSeparator === 'undefined' ? this.thousandsSeparator : args.thousandsSeparator;\n    this.cursor             = typeof args.cursor             === 'undefined' ? this.cursor             : args.cursor;\n  }\n};\n","const Args = require('./args');\nmodule.exports = class Core {\n  constructor(args) {\n    this.args = new Args(args);\n  }\n\n  addCompleter(value, completer, length, start = true) {\n    while (value.length < length) {\n      value = start ? `${completer}${value}` : `${value}${completer}`;\n    }\n\n    return value;\n  }\n\n  addPrefix(value) {\n    return `${this.args.prefix}${value}`;\n  }\n\n  addSeparators(value) {\n    let size = value.length - this.args.fractionDigits;\n    let character = this.args.fixed ? 'd' : 'w';\n    let regexp = `\\\\,?||\\\\.?(\\\\${character})`;\n    let hundreds = Math.ceil(size / 3);\n\n    let replacement = `${this.args.decimalSeparator}$${hundreds + 1}`;\n\n    for (let i = hundreds; i !== 0; i--) {\n      if (size >= 3) {\n        regexp = `(\\\\${character}{3})${regexp}`;\n        size -= 3;\n      } else {\n        regexp = `(\\\\${character}{${size}})${regexp}`;\n      }\n\n      if (i > 1) {\n        replacement = `${this.args.thousandsSeparator}$${i}${replacement}`;\n      } else {\n        replacement = `$${i}${replacement}`;\n      }\n    }\n\n    return value.replace(new RegExp(regexp), replacement);\n  }\n\n  addSuffix(value) {\n    return `${value}${this.args.suffix}`;\n  }\n\n  adjustDotPosition(value) {\n    let fractionDigits;\n    let result = value.toString();\n\n    result = result.replace('.', '');\n    fractionDigits = result.length - this.args.fractionDigits;\n    result = `${result.substring(0, fractionDigits)}.${result.substring(fractionDigits)}`;\n\n    return result;\n  }\n\n  completer(size = 1) {\n    return this.args.fixed ? ''.padEnd(size, '0') : ''.padEnd(size, '_');\n  }\n\n  checkNumberStart(value, separator) {\n    const result = value.toString();\n    return result[0] === separator ? `${this.args.fixed ? '0' : '_'}${result}` : result;\n  }\n\n  checkSuffix(value) {\n    let result;\n    const lastIndex = value.length - 1;\n    const lastButOneIndex = lastIndex - 1;\n    const currentLastSuffix = value.substring(lastIndex - this.args.suffix.length + 1, lastIndex + this.args.suffix.length);\n    const currentLastButOneSuffix = value.substring(lastButOneIndex - this.args.suffix.length + 1, lastButOneIndex + this.args.suffix.length);\n\n    switch (this.args.suffix) {\n      case currentLastSuffix:\n        result = value;\n        break;\n      case currentLastButOneSuffix:\n        var start = value.substring(0, lastButOneIndex);\n        result = `${start}${value.substring(value.length + this.args.suffix.length + 1, lastButOneIndex + this.args.suffix.length)}.`;\n        break;\n      default:\n        result = `${value.substring(0, lastIndex)}.`;\n        break;\n    }\n\n    return result;\n  }\n\n  emptyOrInvalid() {\n    return `${this.completer()}${this.args.decimalSeparator}${this.completer(this.args.fractionDigits)}`;\n  }\n\n  isFloat(number) {\n    return number % 1 !== 0;\n  }\n\n  mask(value) {\n    const negative = this.args.allowNegative && value.indexOf('-') !== -1;\n    let result = `${this.writingToNumber(value) || this.emptyOrInvalid()}`;\n    result = this.replaceSeparator(result, this.args.decimalSeparator, '.');\n    const completer = this.completer();\n\n    if (!isNaN(this.removeCompleter(result, completer))) {\n      result = this.replaceSeparator(result, '.');\n      result = this.addCompleter(result || '', completer, this.args.fractionDigits);\n      result = this.args.fractionDigits >= result.length ? `${completer}${result}` : result;\n      result = this.addSeparators(result);\n    }\n\n    if (this.args.prefix) {\n      result = this.addPrefix(result);\n    }\n    if (this.args.suffix) {\n      result = this.addSuffix(result);\n    }\n\n    return `${!this.args.negativeSignAfter && negative ? '-' : ''}${result}${this.args.negativeSignAfter && negative ? '-' : ''}`;\n  }\n\n  numberToText(value) {\n    const completer = this.completer();\n    let result = this.emptyOrInvalid();\n    value = this.replaceSeparator(value.toString(), this.args.decimalSeparator, '.');\n\n    if (!isNaN(value)) {\n      if (this.isFloat(value)) {\n        const number = value.split('.');\n        let hundreds = number[0];\n        let decimals = number[1];\n\n        decimals = this.addCompleter(decimals || '', completer, this.args.fractionDigits, false);\n\n        result = `${hundreds}${decimals}`;\n      } else {\n        result = this.removeCompleter(value, completer);\n        result = this.addCompleter(result || '', completer, this.args.fractionDigits + result.length, false);\n      }\n      \n      result = this.addSeparators(result);\n      result = this.checkNumberStart(result, this.args.decimalSeparator);\n    }\n    \n    if (this.args.prefix) {\n      result = this.addPrefix(result);\n    }\n    if (this.args.suffix) {\n      result = this.addSuffix(result);\n    }\n    \n    return result;\n  }\n\n  onlyNumber(value) {\n    const hasDecimalSeparator = value.toString().indexOf(this.args.decimalSeparator);\n    let putDecimalSeparator = false;\n    let result = '';\n\n    for (let i = value.length - 1; i >= 0; i--) {\n      if (isFinite(value[i]) || (!this.args.fixed && value[i] === '_')) {\n        result = value[i] + result;\n      } else if (hasDecimalSeparator !== -1 && !putDecimalSeparator && value[i] === this.args.decimalSeparator) {\n        result = value[i].replace(this.args.decimalSeparator, '.') + result;\n        putDecimalSeparator = true;\n      }\n    }\n\n\n    return result[0] === '.' ? `0${result}` : result;\n  }\n\n  removeCompleter(value, completer, start = true) {\n    const getPosition = () => start ? 0 : value.length - 1;\n    let position = getPosition();\n\n    while (value[position] === completer) {\n      value = value.substring(0, position - 1) + value.substring(position + 1, value.length);\n      position = getPosition();\n    }\n\n    return value;\n  }\n\n  removePrefix(value) {\n    const position = value.indexOf(this.args.prefix, 0);\n\n    if (position !== -1) {\n      value = value.substring(this.args.prefix.length, value.length);\n    }\n\n    return value;\n  }\n\n  removeSuffix(value) {\n    const position = value.indexOf(this.args.suffix, value.length - this.args.suffix.length);\n\n    if (position !== -1) {\n      const start = value.substring(0, position);\n      value = start + value.substring(start.length + this.args.suffix.length - 1, value.length - 1);\n    }\n\n    return value;\n  }\n\n  replaceSeparator(value, separator, replacer = '') {\n    return value.replace(new RegExp(`\\\\${separator}`, 'g'), replacer);\n  }\n\n  textToNumber(value) {\n    let result = value.toString();\n    let completer = this.completer();\n\n    if (this.args.prefix) {\n      result = this.removePrefix(result);\n    }\n\n    if (this.args.suffix) {\n      result = this.removeSuffix(result);\n    }\n\n    result = this.onlyNumber(result);\n\n    if (result) {\n      result = this.removeCompleter(result, completer);\n      result = this.checkNumberStart(result, '.');\n    }\n\n    return result || (this.args.fixed ? '0' : '');\n  }\n\n  writingToNumber(value) {\n    let result = value.toString();\n    let completer = this.completer();\n\n    if (this.args.prefix) {\n      result = this.removePrefix(result);\n    }\n\n    if (this.args.suffix) {\n      result = this.checkSuffix(result);\n      result = this.removeSuffix(result);\n    }\n\n    result = this.onlyNumber(result);\n\n    if (result) {\n      result = this.adjustDotPosition(result);\n\n      result = this.removeCompleter(result, completer);\n\n      result = this.checkNumberStart(result, '.');\n    }\n\n    return result || (this.args.fixed ? '0' : '');\n  }\n};\n","module.exports = {\n  getCaretPosition(input) {\n    let position = -1;\n    if ('selectionStart' in input) {\n      position = input.selectionStart;\n    } else if (document.selection) {\n      input.focus();\n      const range = document.selection.createRange();\n      const length = document.selection.createRange().text.length;\n      range.moveStart('character', -input.value.length);\n      position = range.text.length - length;\n    }\n    return position;\n  },\n\n  setCaretPosition(input, index) {\n    if (input.setSelectionRange) {\n      input.focus();\n      input.setSelectionRange(index, index);\n    } else if (input.createTextRange) {\n      const range = input.createTextRange();\n      range.collapse(true);\n      range.moveEnd('character', index);\n      range.moveStart('character', index);\n      range.select();\n    }\n  },\n\n  indexMove(newValue, oldValue, index) {\n    switch (true) {\n      case oldValue.length < newValue.length:\n        return index + 1;\n      case oldValue.length > newValue.length:\n        return index - 1;\n      default:\n        return index;\n    }\n  },\n\n  addPropertyMask(input, core) {\n    input.maskArgs = {};\n\n    for (const k in core.args) {\n      Object.defineProperty(input.maskArgs, k, {\n        get: () => core.args[k],\n        set: (value) => {\n          core.args[k] = value;\n          this.refreshMask(input);\n        }\n      });\n    }\n  },\n\n  addMask(input, core) {\n    input.addEventListener('input', e => {\n      const oldValue = input.value;\n      core.args.beforeFormat(oldValue);\n      const newValue = core.mask(oldValue);\n      const oldCaretPosition = this.getCaretPosition(input);\n      let newCaretPosition = this.indexMove(newValue, oldValue, oldCaretPosition);\n\n      if (input.maskArgs.cursor === 'start') {\n        newCaretPosition = 0;\n      } else if (input.maskArgs.cursor === 'end') {\n        newCaretPosition = newValue.length;\n      }\n\n      input.value = newValue;\n      input._value = newValue;\n\n      this.setCaretPosition(input, newCaretPosition);\n      core.args.afterFormat(newValue);\n      !(e instanceof Event) && this.refreshMask(input);\n    });\n  },\n\n  refreshMask(input) {\n    input.dispatchEvent(new Event('input'));\n  }\n};\n","const Args = require('./args');\nconst Core = require('./core');\nconst implanter = require('./implanter');\n\nlet _args = new Args();\n\nmodule.exports = class SimpleMaskMoney {\n  static get args() {\n    return _args;\n  }\n\n  static set args(value) {\n    _args = new Args(value);\n  }\n\n  static formatToCurrency(value, args) {\n    const core = new Core(typeof args !== 'undefined' && typeof args === 'object' ? args : _args);\n    core.args.beforeFormat(value);\n\n    const negative = core.args.allowNegative && value.indexOf('-') !== -1;  \n    const formatation = core.numberToText(core.textToNumber(value));\n    const result = `${!core.args.negativeSignAfter && negative ? '-': ''}${formatation}${core.args.negativeSignAfter && negative ? '-': ''}`;\n  \n    core.args.afterFormat(result);\n    \n    return result;\n  }\n\n  static formatToMask(input, args) {\n    const core = new Core(typeof args !== 'undefined' && typeof args === 'object' ? args : _args);\n    const value = input.toString(); \n    core.args.beforeFormat(value);\n\n    const result = core.mask(value);\n\n    core.args.afterFormat(result);\n    \n    return result;\n  }\n\n  static formatToNumber(input, args) {\n    const core = new Core(typeof args !== 'undefined' && typeof args === 'object' ? args : _args);\n    let value = input.toString(); \n    core.args.beforeFormat(value);\n    let result = '0';\n\n    const negative = core.args.allowNegative && value.indexOf('-') !== -1;   \n    \n    if (negative) {\n      value = value.replace('-', '');\n    }\n\n    value = core.textToNumber(value);\n    \n    if (!this.args.fixed) {\n      value = value.replace(new RegExp('_', 'g'), '');\n    }\n\n    if (!isNaN(value)) {\n      result = parseFloat(negative ? value * -1 : value);\n    }\n\n    core.args.afterFormat(result);\n      \n    return result;\n  }\n\n  static setMask(element, args) {\n    if (typeof document === 'undefined') throw 'This function only works on client side';\n\n    const input = typeof element == 'string' ? document.querySelector(element) : element;    \n    const core = new Core(typeof args !== 'undefined' && typeof args === 'object' ? args : _args);\n    \n    implanter.addPropertyMask(input, core);\n    implanter.addMask(input, core);\n    implanter.refreshMask(input);\n\n    input.formatToNumber = () => SimpleMaskMoney.formatToNumber(input.value, input.maskArgs);\n\n    return input;\n  }\n};\n"],"names":["module","args","afterFormat","allowNegative","beforeFormat","negativeSignAfter","decimalSeparator","fixed","fractionDigits","prefix","suffix","thousandsSeparator","cursor","merge","isNaN","parseInt","Args","value","completer","length","start","size","character","regexp","hundreds","Math","ceil","replacement","i","replace","RegExp","result","toString","substring","padEnd","separator","lastIndex","lastButOneIndex","currentLastSuffix","currentLastButOneSuffix","number","negative","indexOf","writingToNumber","emptyOrInvalid","replaceSeparator","removeCompleter","addCompleter","addSeparators","addPrefix","addSuffix","isFloat","split","decimals","checkNumberStart","hasDecimalSeparator","putDecimalSeparator","isFinite","getPosition","position","replacer","removePrefix","removeSuffix","onlyNumber","checkSuffix","adjustDotPosition","input","selectionStart","document","selection","focus","range","createRange","text","moveStart","index","setSelectionRange","createTextRange","collapse","moveEnd","select","newValue","oldValue","core","maskArgs","k","defineProperty","refreshMask","addEventListener","mask","oldCaretPosition","getCaretPosition","newCaretPosition","indexMove","_value","setCaretPosition","e","Event","dispatchEvent","_args","Core","formatation","numberToText","textToNumber","parseFloat","element","querySelector","addPropertyMask","addMask","formatToNumber","SimpleMaskMoney"],"mappings":"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"}